# MailerSend - ?????? ????????????

## 1. ???????? API Token

1. ?????????????? ?? https://www.mailersend.com/
2. Settings ? API Tokens ? Generate New Token
3. ??????? scope: **Email: Full Access**
4. ????????? ?????

## 2. ??????????? ????????

```bash
# ?????????? ?????
dotnet user-secrets set "MailerSend:Token" "mlsn.YOUR_TOKEN_HERE" --project src/Hosts/ApiHost

# ?????????? from email (?????????????? verified email!)
dotnet user-secrets set "MailerSend:FromEmail" "your-verified-email@example.com" --project src/Hosts/ApiHost

# (???????????) ????? ???????????
dotnet user-secrets set "MailerSend:FromName" "WebSearchIndexing" --project src/Hosts/ApiHost
```

## 3. ???????????? From Email

### ??????? A: ??? testing (????????)
1. MailerSend Dashboard ? Domains
2. ??????? ??????? email ??? ???????????
3. ????????? inbox ? ???????????

### ??????? B: ??? production (?????????????)
1. ??????? ??? ?????
2. ?????????? DNS ?????? (SPF, DKIM, DMARC)
3. ??????????? ???????????

## 4. ??????????

```bash
# ????????? ???????
dotnet run --project src/Hosts/ApiHost

# ? ????? ????????:
# [INF] IdentityEmailService initialized. FromEmail: your@email.com, Token length: 64
```

## 5. ???????????? ?????????

```bash
# ???????????? Swagger UI
http://localhost:7001/swagger

# ??? curl
curl -X POST "http://localhost:7001/api/identity/email-verification/send" \
  -H "Content-Type: application/json" \
  -d '{"userId": "your-user-guid"}'
```

## ?????? ???????

### ? "MailerSend token is not configured"
```bash
# ????????? user secrets
dotnet user-secrets list --project src/Hosts/ApiHost

# ?????????? ?????
dotnet user-secrets set "MailerSend:Token" "mlsn.xxx" --project src/Hosts/ApiHost
```

### ? "Status: 401, Unauthorized"
- ????????? ???????????? ??????
- ?????????????, ?? ????? ??? scope "Email: Full Access"

### ? "Status: 422, from.email field must be verified"
- Email ?????? ? `FromEmail` ??? ???? ???????????? ? MailerSend
- ????????? ?? MailerSend Dashboard ? Domains

## ???????? ????? ? Seq

```bash
# ????????? Seq
docker-compose up seq -d

# ????????? http://localhost:5341
# Username: admin
# Password: Admin123!

# ?????? ??? email ?????:
SourceContext like '%IdentityEmailService%'
```

## Production

```bash
# ??? Docker Compose
export MAILERSEND_TOKEN="mlsn.xxx"
export MAILERSEND_FROM_EMAIL="noreply@yourdomain.com"

docker-compose up
```

## ????????? ????????????

???????? ??????????: [docs/mailersend-setup.md](./docs/mailersend-setup.md)
