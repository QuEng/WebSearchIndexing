# ??????????? ??????? ? ReportingHttpClient

## ????????
? `GetDashboardStatsAsync` ??????? null reference exception ????? ??????????? ??????? ??????? ?? ??????????? ???????? ???????????? HttpClient ??? Blazor Server.

## ?????????? ????????

### 1. ??????????? ??????? ????????
**????**: ?????? catch ????, ???? ?????? ??? ??????? ? ???????? ???????? ??'???
```csharp
catch (Exception ex)
{
    // ?????? ????
}
return new();
```

**?????**: ????????? ??????? ??????????? ???????? ? ????????????? GetFromJsonAsync
```csharp
try
{
    var result = await _httpClient.GetFromJsonAsync<DashboardStatsDto>("/api/reporting/dashboard", cancellationToken);
    return result ?? new DashboardStatsDto();
}
catch (HttpRequestException)
{
    // ??????? ??????? HTTP ?????? ?? ?????????? ???????? ????
    return new DashboardStatsDto();
}
catch (TaskCanceledException ex) when (ex.InnerException is TimeoutException)
{
    // ?????????? ???????
    return new DashboardStatsDto();
}
```

### 2. ???????????? GetFromJsonAsync ??????? ?????? ????????????
**????**: ????? ???????????? JSON ? ???????????? ??????????
```csharp
var json = await response.Content.ReadAsStringAsync(cancellationToken);
return JsonSerializer.Deserialize<DashboardStatsDto>(json, _jsonOptions)!;
```

**?????**: ???????????? ??????????? ?????? .NET
```csharp
var result = await _httpClient.GetFromJsonAsync<DashboardStatsDto>("/api/reporting/dashboard", cancellationToken);
return result ?? new DashboardStatsDto();
```

### 3. ???????????? HttpClient ??? Blazor Server ?? ?????????? ???????? ?? WASM
**??????**: ???????????? HttpClient ? WebHost Program.cs ??? ????????? ???? ?????????:
```csharp
// Configure HttpClient for Blazor Server scenario
builder.Services.AddHttpClient("WebSearchIndexing.Api", client =>
{
    // In Blazor Server, this will be the local API
    // In WASM, this should be configured to point to the API server
    client.Timeout = TimeSpan.FromSeconds(30);
});
```

## ???????????? ???????? ???????

### 1. ?????????? ?? ???????? ?? WASM
- HTTP ?????? ???????????? ??? ?????? ? ???? ??????? (Server/WASM)
- ???????? URL-?????? ????????????? ? ???? ?????????
- ?????????? ????? ???????? ??? ????????

### 2. ??????????
- ????????? ??????? HTTP ???????
- ??????? ??? ??????????? ?????????
- Fallback ?? ????????? ????? ??? ????????

### 3. ??????????????
- ???????????? `GetFromJsonAsync` ??? ???????????? ??????????????
- ???????????? ????????? ??? ??????????? ??????????????? ???????

## ?????????? ? ?????????? ????????? ?? WASM

### Blazor Server (???????? ????)
- HttpClient ???????????? ???????? URL
- API ??????? ??????????? ?? ???????
- ?????? ?????? ?? ?????????? API

### Blazor WASM (???????? ????????)
- ??? ????? HttpClient ???
- API ??????? ??????????? ? ????????
- ???????? ???? ??????????? BaseAddress ?? API ??????

### ????????? ????? ??? WASM
??? ???????? ?? WASM ???????? ???? ???? ??????????? BaseAddress ? Program.cs WASM ?????:
```csharp
builder.Services.AddHttpClient<IReportingHttpClient, ReportingHttpClient>(client =>
{
    client.BaseAddress = new Uri("https://api.yourapp.com/");
    client.Timeout = TimeSpan.FromSeconds(30);
});
```

## ?????????
- ?????? ??????? ?????????? ??? ???????
- HTTP ?????? ??????? ?? ?????? ? Blazor Server
- ??????????? ???????????? ??? ?????????? ???????? ?? WASM
- ??????? ??????? ??????? ?? fallback ????????
